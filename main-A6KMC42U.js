import{A as L,B as x,C as R,D as B,E as J,F as I,G as q,H as G,I as Z,J as K,K as Q,L as X,M as Y,O as ee,P as te,Q as F,Z as ie,a as U,b as j,c as v,d as h,e as f,f as T,g as l,h as b,i as p,j as d,l as u,m as w,n as P,o,p as n,q as S,r as y,s as M,t as E,u as g,v as s,w as V,x as W,y as a,z as C}from"./chunk-DD5ML2ZJ.js";var k=class t{constructor(i){this.http=i}apiUrl="https://tecweb-project.duckdns.org";obtenerPeliculaPorId(i){return this.http.get(`${this.apiUrl}/movie/${i}`)}buscarPeliculasPorTitulo(i){return this.http.get(`${this.apiUrl}/search?q=${i}`)}getHeaders(){let i=localStorage.getItem("token");return new Z({Authorization:`Bearer ${i}`,"Content-Type":"application/json"})}addToWatchlist(i,e,r=!1){let c=this.getHeaders();return this.http.post(`${this.apiUrl}/watchlist?user_id=${i}&movie_id=${e}&watched=${r}`,{},{headers:c})}getWatchlist(i){let e=this.getHeaders();return this.http.get(`${this.apiUrl}/watchlist?user_id=${i}`,{headers:e})}actualizarWatched(i,e,r){let c=this.getHeaders();return this.http.patch(`${this.apiUrl}/watchlist?user_id=${i}&movie_id=${e}&watched=${r}`,null,{headers:c})}deleteElementWatchList(i,e){let r=this.getHeaders();return this.http.delete(`${this.apiUrl}/watchlist?user_id=${i}&movie_id=${e}`,{headers:r})}static \u0275fac=function(e){return new(e||t)(j(K))};static \u0275prov=U({token:t,factory:t.\u0275fac,providedIn:"root"})};var le=(t,i)=>i.id,ce=(t,i)=>i.name;function se(t,i){t&1&&(o(0,"p"),a(1,"Buscando pel\xEDculas..."),n())}function me(t,i){if(t&1&&S(0,"img",5),t&2){let e=s().$implicit;d("src","https://image.tmdb.org/t/p/w200"+e.poster_path,T)("alt","P\xF3ster de "+e.title)}}function pe(t,i){t&1&&(o(0,"span"),a(1,"No disponible"),n())}function de(t,i){if(t&1&&(o(0,"span",9),a(1),n()),t&2){let e=i.$implicit;l(),C(e.name)}}function ue(t,i){if(t&1&&(o(0,"div",6)(1,"strong"),a(2,"G\xE9neros:"),n(),w(3,de,2,1,"span",9,ce),n()),t&2){let e=s().$implicit;l(3),P(e.genres)}}function _e(t,i){if(t&1){let e=E();y(0),o(1,"button",10),g("click",function(){h(e);let c=s().$implicit,m=s(3);return f(m.addToWatchlist(c.id))}),a(2," Agregar a Watchlist "),n(),M()}if(t&2){let e=s(4);l(),d("disabled",e.isAddingToWatchlist)}}function he(t,i){t&1&&(o(0,"span",8),a(1,"\xA1Agregado a la watchlist!"),n())}function fe(t,i){if(t&1&&(o(0,"div",4)(1,"h3"),a(2),n(),p(3,me,1,2,"img",5)(4,pe,2,0,"span"),o(5,"p"),a(6),n(),p(7,ue,5,0,"div",6)(8,_e,3,1,"ng-container",7)(9,he,2,0,"span",8),n()),t&2){let e=i.$implicit,r=s(3);l(2),C(e.title),l(),u(e.poster_path?3:4),l(3),C(e.overview),l(),u(e.genres&&e.genres.length>0?7:-1),l(),d("ngIf",r.authService.isAuthenticated()),l(),u(r.additionSuccess[e.id]?9:-1)}}function ge(t,i){if(t&1&&(o(0,"h2"),a(1,"Resultados de la b\xFAsqueda:"),n(),w(2,fe,10,6,"div",4,le)),t&2){let e=s(2);l(2),P(e.movies)}}function ve(t,i){t&1&&(o(0,"p"),a(1,"No se encontraron pel\xEDculas"),n())}function Ce(t,i){if(t&1&&p(0,ge,4,0)(1,ve,2,0,"p"),t&2){let e=s();u(e.movies&&e.movies.length>0?0:1)}}var $=class t{constructor(i,e){this.peliculasService=i;this.authService=e}movies=[];isAddingToWatchlist=!1;additionSuccess={};isSearching=!1;hasSearched=!1;addToWatchlist(i){this.isAddingToWatchlist=!0;let e=this.getCurrentUserId();this.peliculasService.addToWatchlist(e,i).subscribe({next:()=>{this.additionSuccess[i]=!0,setTimeout(()=>{this.additionSuccess[i]=!1},3e3)},error:r=>{console.error("Error adding to watchlist:",r)},complete:()=>{this.isAddingToWatchlist=!1}})}getCurrentUserId(){return JSON.parse(localStorage.getItem("user")||"{}").id}obtenerPeliculas(){this.peliculasService.obtenerPeliculaPorId(2).subscribe(e=>{this.movies=e,console.log("Pel\xEDculas obtenidas:",this.movies)},e=>{console.error("Error al obtener pel\xEDculas:",e)})}buscarPeliculasPorTitulo(i){if(!i){console.error("El t\xEDtulo de la pel\xEDcula no puede estar vac\xEDo");return}this.isSearching=!0,this.hasSearched=!0,this.peliculasService.buscarPeliculasPorTitulo(i).subscribe({next:e=>{this.movies=e,console.log("Pel\xEDculas encontradas:",this.movies)},error:e=>{console.error("Error al buscar pel\xEDculas:",e),this.movies=[]},complete:()=>{this.isSearching=!1}})}static \u0275fac=function(e){return new(e||t)(b(k),b(F))};static \u0275cmp=v({type:t,selectors:[["app-movie-list"]],standalone:!0,features:[x],decls:9,vars:1,consts:[["titleInput",""],["for","title"],["type","text","id","title","placeholder","Escribe el t\xEDtulo de la pel\xEDcula",3,"keydown.enter"],[3,"click"],[1,"movie-card"],[2,"width","100px",3,"src","alt"],[1,"genres"],[4,"ngIf"],[1,"success-message"],[1,"genre-tag"],[1,"watchlist-button",3,"click","disabled"]],template:function(e,r){if(e&1){let c=E();o(0,"div")(1,"label",1),a(2,"Buscar por t\xEDtulo:"),n(),o(3,"input",2,0),g("keydown.enter",function(){h(c);let _=W(4);return f(r.buscarPeliculasPorTitulo(_.value))}),n()(),o(5,"button",3),g("click",function(){h(c);let _=W(4);return f(r.buscarPeliculasPorTitulo(_.value))}),a(6,"Buscar"),n(),p(7,se,2,0,"p")(8,Ce,2,1)}e&2&&(l(7),u(r.isSearching?7:r.hasSearched?8:-1))},dependencies:[I],styles:[".movie-card[_ngcontent-%COMP%]{border:1px solid #ddd;padding:1rem;margin-bottom:1rem;border-radius:4px}.genre-tag[_ngcontent-%COMP%]{background:#e0e0e0;padding:.2rem .5rem;border-radius:4px;margin-right:.5rem}.watchlist-button[_ngcontent-%COMP%]{background:#007bff;color:#fff;border:none;padding:.5rem 1rem;border-radius:4px;cursor:pointer;margin-top:1rem}.watchlist-button[_ngcontent-%COMP%]:disabled{background:#ccc}.success-message[_ngcontent-%COMP%]{color:green;margin-left:1rem}"]})};var xe=(t,i)=>i.movie_id,be=(t,i)=>i.id;function Se(t,i){if(t&1&&S(0,"img",0),t&2){let e=s().$implicit;d("src","https://image.tmdb.org/t/p/w200"+e.poster_path,T)("alt","P\xF3ster de "+e.title)}}function Ee(t,i){t&1&&(o(0,"span"),a(1,"No disponible"),n())}function we(t,i){if(t&1&&S(0,"img",1),t&2){let e=s().$implicit;d("src","https://image.tmdb.org/t/p/w300"+e.backdrop_path,T)("alt","Backdrop de "+e.title)}}function Pe(t,i){t&1&&(o(0,"span"),a(1,"No disponible"),n())}function ke(t,i){if(t&1&&(o(0,"ul")(1,"li"),a(2),n()()),t&2){let e=i.$implicit;l(2),C(e.name)}}function Te(t,i){if(t&1&&w(0,ke,3,1,"ul",null,be),t&2){let e=s().$implicit;P(e.genres)}}function ye(t,i){if(t&1){let e=E();o(0,"tr")(1,"td"),p(2,Se,1,2,"img",0)(3,Ee,2,0,"span"),n(),o(4,"td"),p(5,we,1,2,"img",1)(6,Pe,2,0,"span"),n(),o(7,"td"),a(8),n(),o(9,"td")(10,"div",2)(11,"input",3),g("change",function(){let c=h(e).$implicit,m=s(2);return f(m.actualizarEstadoVisto(c.movie_id,!c.watched))}),n(),o(12,"label",4),a(13),n()()(),o(14,"td"),a(15),n(),o(16,"td"),a(17),R(18,"number"),n(),o(19,"td"),a(20),n(),o(21,"td"),p(22,Te,2,0),n(),o(23,"td")(24,"button",5),g("click",function(){let c=h(e).$implicit,m=s(2);return f(m.eliminarElementoWatchlist(c.movie_id))}),a(25," Eliminar "),n()()()}if(t&2){let e=i.$implicit;l(2),u(e.poster_path?2:3),l(3),u(e.backdrop_path?5:6),l(3),C(e.title),l(3),V("id","watched-",e.movie_id,""),d("checked",e.watched),l(),V("for","watched-",e.movie_id,""),l(),L(" ",e.watched?"Visto":"No visto"," "),l(2),L("",e.runtime," min"),l(2),L("",B(18,13,e.vote_average,"1.1-1"),"/10"),l(3),C(e.release_date),l(2),u(e.genres&&e.genres.length>0?22:-1)}}function Me(t,i){if(t&1&&(o(0,"h2"),a(1,"Resultados de la b\xFAsqueda:"),n(),o(2,"table")(3,"thead")(4,"tr")(5,"th"),a(6,"P\xF3ster"),n(),o(7,"th"),a(8,"Backdrop"),n(),o(9,"th"),a(10,"T\xEDtulo"),n(),o(11,"th"),a(12,"Visto"),n(),o(13,"th"),a(14,"Duraci\xF3n"),n(),o(15,"th"),a(16,"Valoraci\xF3n"),n(),o(17,"th"),a(18,"Fecha de lanzamiento"),n(),o(19,"th"),a(20,"G\xE9neros"),n(),o(21,"th"),a(22,"Acciones"),n()()(),o(23,"tbody"),w(24,ye,26,16,"tr",null,xe),n()()),t&2){let e=s();l(24),P(e.watchList)}}function Le(t,i){t&1&&(o(0,"h2"),a(1,"No se encontraron pel\xEDculas"),n())}var A=class t{constructor(i){this.peliculasService=i}ngOnInit(){this.obtenerWatchList(),console.log("xDDDD obtenidas:",this.watchList)}watchList=[];obtenerWatchList(){let i=localStorage.getItem("user");if(i!=null){let e=JSON.parse(i);this.peliculasService.getWatchlist(e.id).subscribe(r=>{this.watchList=r,console.log("Pel\xEDculas obtenidas:",r)},r=>{console.error("Error al obtener pel\xEDculas:",r)})}}actualizarEstadoVisto(i,e){let r=localStorage.getItem("user");if(r!=null){let c=JSON.parse(r);this.peliculasService.actualizarWatched(c.id,i,e).subscribe({next:m=>{console.log("Estado actualizado correctamente:",m);let _=this.watchList.find(N=>N.movie_id===i);_&&(_.watched=e)},error:m=>{console.error("Error al actualizar el estado:",m);let _=this.watchList.find(N=>N.movie_id===i);_&&(_.watched=!e)}})}}eliminarElementoWatchlist(i){let e=localStorage.getItem("user");if(e!=null){let r=JSON.parse(e);this.peliculasService.deleteElementWatchList(r.id,i).subscribe({next:c=>{console.log("Elemento eliminado correctamente:",c),this.watchList=this.watchList.filter(m=>m.movie_id!==i)},error:c=>{console.error("Error al eliminar el elemento:",c)}})}}static \u0275fac=function(e){return new(e||t)(b(k))};static \u0275cmp=v({type:t,selectors:[["app-peliculas"]],standalone:!0,features:[x],decls:2,vars:1,consts:[[2,"width","100px",3,"src","alt"],[2,"width","200px",3,"src","alt"],[1,"watched-toggle"],["type","checkbox",3,"change","checked","id"],[3,"for"],[3,"click"]],template:function(e,r){e&1&&p(0,Me,26,0)(1,Le,2,0,"h2"),e&2&&u(r.watchList.length>0?0:1)},dependencies:[G,q,ie],styles:["table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin:20px 0}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;border:1px solid #ddd;text-align:left}table[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{display:block;max-width:100%;height:auto}"]})};var oe=[{path:"buscar-peliculas",component:$},{path:"register",loadComponent:()=>import("./chunk-VWR3QJFF.js").then(t=>t.RegisterComponent)},{path:"login",loadComponent:()=>import("./chunk-SLO6YS2Z.js").then(t=>t.LoginComponent)},{path:"*",redirectTo:"login"},{path:"watchList",component:A}];var ae={providers:[J({eventCoalescing:!0}),te(oe),Q()]};function Ie(t,i){t&1&&(o(0,"a",9),a(1," Lista de pel\xEDculas "),n())}function Fe(t,i){t&1&&(y(0),o(1,"a",10),a(2," Registrarse "),n(),o(3,"a",11),a(4," Login "),n(),M())}function Oe(t,i){if(t&1){let e=E();o(0,"button",12),g("click",function(){h(e);let c=s();return f(c.logout())}),a(1," Logout "),n()}}var D=class t{constructor(i){this.authService=i}logout(){this.authService.logout()}static \u0275fac=function(e){return new(e||t)(b(F))};static \u0275cmp=v({type:t,selectors:[["app-header"]],standalone:!0,features:[x],decls:11,vars:3,consts:[[1,"header-nav"],[1,"nav-container"],[1,"nav-left"],["routerLink","/",1,"brand-logo"],["routerLink","/buscar-peliculas",1,"nav-link"],["routerLink","/watchList","class","nav-link",4,"ngIf"],[1,"nav-right"],[4,"ngIf"],["class","nav-link logout-btn",3,"click",4,"ngIf"],["routerLink","/watchList",1,"nav-link"],["routerLink","/register",1,"nav-link"],["routerLink","/login",1,"nav-link"],[1,"nav-link","logout-btn",3,"click"]],template:function(e,r){e&1&&(o(0,"nav",0)(1,"div",1)(2,"div",2)(3,"a",3),a(4,"Filmoteca"),n(),o(5,"a",4),a(6," Buscar Pel\xEDculas "),n(),p(7,Ie,2,0,"a",5),n(),o(8,"div",6),p(9,Fe,5,0,"ng-container",7)(10,Oe,2,0,"button",8),n()()()),e&2&&(l(7),d("ngIf",r.authService.isAuthenticated()),l(2),d("ngIf",!r.authService.isAuthenticated()),l(),d("ngIf",r.authService.isAuthenticated()))},dependencies:[ee,I],styles:[".header-nav[_ngcontent-%COMP%]{background-color:#1f2937;padding:1rem;color:#fff}.nav-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;display:flex;justify-content:space-between;align-items:center}.nav-left[_ngcontent-%COMP%], .nav-right[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.brand-logo[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700;text-decoration:none;color:#fff}.nav-link[_ngcontent-%COMP%]{color:#fff;text-decoration:none;padding:.5rem;transition:color .2s ease}.nav-link[_ngcontent-%COMP%]:hover{color:#d1d5db}.logout-btn[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;font-size:1rem;padding:.5rem}.logout-btn[_ngcontent-%COMP%]:hover{color:#d1d5db}"]})};var H=class t{title="frontend";static \u0275fac=function(e){return new(e||t)};static \u0275cmp=v({type:t,selectors:[["app-root"]],standalone:!0,features:[x],decls:3,vars:0,template:function(e,r){e&1&&(o(0,"div"),S(1,"app-header")(2,"router-outlet"),n())},dependencies:[Y,D]})};X(H,ae).catch(t=>console.error(t));
